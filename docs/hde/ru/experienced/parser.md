# Углублённое изучение Parser

(исходник: [src/CustomizableException/Parser.php](../../../../src/CustomizableException/Parser.php))

Данная статья посвящена ряду способов расширить возможности [Parser](../dummies/parser.md).
Если вы ещё не знакомы с основным функционалом библиотеки, [изучите его](../dummies/about.md) в первую очередь!

Содержание:
- [Загрузка одного класса за раз](#загрузка-одного-класса-за-раз)
- [Ваши фильтры исключений](#ваши-фильтры-исключений)
- [Настройка вывода](#настройка-вывода)

## Загрузка одного класса за раз

**Parser** может выбросить исключение на любую ошибку валидации. Процесс разбора будет прерываться (разве что вы
задатите любую из настроек '_ignore_invalid_' или '_add_errors_'). В такой ситуации не все классы исключений попадают
под обработку. Так что и вам нет необходимости загружать в память все классы за один присест.

**Parser** предоставляет вам метод `loadClass()`. Данный метод вызывается для загрузки класса `$config_class_name`, а
также для каждого класса, который вы указали в `CLASS_CODE_LIST`, перед его обработкой. Изначально данный метод вообще
ничего не делает, но вы можете переопределить его, дабы загружать с помощью него классы исключений по их полным именам.

## Ваши фильтры исключений

В **Parser** уже есть ряд встроенных [фильтров исключений](../dummies/parser.md#фильтрация-исключений). Если вы хотите
добавить новые фильтры (к примеру, в связи с добавлением поддержки нового свойства для `EXCEPTIONS_PROPERTIES`), вам
следует переопределить `needFilterException()`. Данный метод вызывается после обработки всех встроенных фильтров; метод
отвечает на вопрос, должно ли очередное исключение быть выкинутым из обработки.

Изначально `needFilterException()` всегда возвращает **false** (т. е. все исключения остаются в обработке). Параметрами
метода являются `$filters`, _базовый код_ исключения и `$options`; массивы `$filters` и `$options` - те же самые, что
задаются вами при вызове `parse()`, и без изменений передаются по ссылкам.

## Настройка вывода

Если **Parser** успешно завершает свою работу, он возвращает
[обработанные данные](../dummies/parser.md#возвращаемые-данные) (кроме случаев, когда включена настройка '_no_data_').
Встроенный алгоритм формирования ответа реализован в `addExceptionData()`. Переопределите данный метод, если хотите
каким-либо образом изменить возвращаемые данные (к примеру, добавив дополнительные данные или изменив сам формат).

`addExceptionData()` принимает параметры:
- `$parsed_data` - массив уже обработанных данных, который будет возвращен методом `parse()` в конце его работы;
передаётся по ссылке.
- `$options` - массив настроек, заданных для `parse()`; без изменений передаётся по ссылке.
- `$properties` - массив свойств исключения (один из элементов `EXCEPTIONS_PROPERTIES`); без изменений передаётся по
ссылке.
- `$basis` - массив с данными исключения:
    - `'base_code'` => (_базовый_) код исключения
    - `'class_code'` => _код класса_ исключения
    - `'class_name'` => полное имя класса исключения

## Читайте также

- [Углублённое изучение GlobalException](global-exception.md)
- [Углублённое изучение CustomizableException](customizable-exception.md)
- [Основы Parser](../dummies/customizable-exception.md)
